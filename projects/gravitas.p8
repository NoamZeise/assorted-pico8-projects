pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--sspr(12, 3, 8,13)
actors={}
cam={}
cam.x=0
cam.y=0
cam.time=time()
function _init()
 add(actors, makeactor(40, 40))

end

function _update()
 for a in all(actors) do
		a=physics(a)
		a=bounds(a)
		a=control(a)
	end
	camerafollow(actors[1], 10)
	camera(cam.x, cam.y)
end

function _draw()
	cls(2)
	map(0,4,0,0)
	for a in all(actors) do
		sspr(a.sx, a.sy, a.sw, a.sh,a.x,a.y)
	end
end

-->8
function makeactor(x, y)--where 1 is player 2 is enemy
	a={}
	
	a.sx=8
	a.sy=0
	a.sw=16
	a.sh=16
--coords
	a.x=x
	a.y=y
	a.prevx=x
	a.prevy=y
--horizontal
	a.hv=0
	a.ha=0
	a.fr=0.2
--vertical
	a.gravity=10
	a.vv=0
	a.va=a.gravity
	a.bounce=0.2
--timings and bools
	a.time=time()
	a.groundtime = time()
	a.connecttime =time()
	a.grounded=false
	return a
end

function physics(a)
	--check if player is in same place
	if not(flr(a.prevx)==flr(a.x) and flr(a.prevy)==flr(a.y)) then
		a.connecttime=time()
	end
	a.prevx=a.x
	a.prevy=a.y
 --work out velocity
	a.hv+=(a.ha*(time()-a.time))
	a.vv+=(a.va*(time()-a.time))
	a.x+=a.hv
	a.y+=a.vv
	a.time=time()
	return a
end	

function bounds(a)
	bottomy=a.y+39
 pix=mget(((a.x + (a.sw/2))/8),(bottomy/8)+1)
 while fget(pix,0) do
		a.y=a.y-1
		a.vv=-(a.bounce*a.vv)
		a.grounded=true
		a.groundtime=time()
		bottomy=a.y+a.sh
  pix=mget((a.x/8),(bottomy/8)+1)
	end
	if(a.x>(131-a.sw) + cam.x)then
		a.x=(131-a.sw)+cam.x
		a.hv=-(a.bounce*a.hv)
		--dont bounce if in same spot for a while
		if(time()-a.connecttime)>0.1 then a.hv=0 end
	end
	--check if player is touching left
	if(a.x<(-19+a.sw)+cam.x)then
		a.x=((-19+a.sw)+cam.x)
		a.hv=-(a.bounce*a.hv)
		--dont bounce if in same spot for a while
	 if(time()-a.connecttime)>0.1 then a.hv=0 end
	end
	return a
end

function jump(a)
	a.vv= -5
	a.grounded=false
	return a
end

function control(a)
	if btn(0) then
		a.hv=-2.5
	elseif btn(1) then
	 a.hv=2.5
	elseif a.hv < 0 then
		a.hv+=a.fr
		if a.hv > 0 then
			a.hv=0
		end
	elseif a.hv > 0 then
		a.hv-=a.fr
		if a.hv < 0 then
			a.hv=0
		end
	end
	if (btnp(4) or btnp(2)) and a.grounded then
		a=jump(a)
	end
	return a
end
-->8
function camerascroll(speed)
	cam.x+=(speed * (time() - cam.time))
	cam.time=time()
end

function camerafollow(a, bound)
	offset=a.x - ((128-a.sw)/2)
	if(cam.x -offset > 10) then
		cam.x=offset + bound
	elseif(cam.x-offset<-10)then
		cam.x=offset - bound
	end
	if(cam.x<0)then cam.x=0 end
	if(cam.x>896)then cam.x=896 end
end
__gfx__
000000000000000000000000000000000000000000000000000000003bb3333333333333333bb3333bb333330000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000003b33333b3333bb333333333333bb33330000000000000000000000000000000000000000
007007000001111111111000000000000000000000000000660000003333333bb343b33333b333b3333b33330000000000000000000000000000000000000000
00077000000111111111100000000000000000000000000666600000333bb333b343333433bb333b333333b30000000000000000000000000000000000000000
000770000001111111111000000003663333300000000666666000003343bb34433333bb333b3333333333330000000000000000000000000000000000000000
007007000001111111111000000003666666330000000666666600003343333443bb433b333333333b3333330000000000000000000000000000000000000000
0000000000011111111110000000036666666600000006618666600044434433443b334b443333333b3333440000000000000000000000000000000000000000
00000000000111111111100000000600060006300000001181610000444334444343344444333333333333440000000000000000000000000000000000000000
00000000000111111111100000000660060063300000001118710000444433444434334444343b33343333440000000000000000000000000000000000000000
00000000000111111111100000003666666663000000009918810000444443444434434444343343444343440000000000000000000000000000000000000000
00000000000111111111100000003660000633000000000918010000444443444334433444334343334343340000000000000000000000000000000000000000
00000000000111111111100000003333666663000000000818810000444444444344443444434344434344340000000000000000000000000000000000000000
00000000000111111111100000030030666663300000000118810000444444444444444444433444433344340000000000000000000000000000000000000000
00000000000111111111100000030030333333300000001188810000444444444444444444434444434444340000000000000000000000000000000000000000
00000000000111111111100000030003030330300000001111110000444444444444444444334444444444440000000000000000000000000000000000000000
00000000000111111111100000030003033003300000000110110000444444444444444444444444444444440000000000000000000000000000000000000000
00000000000000000000000000030033003003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000030000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000001010101000000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000015
1600000000000000000000000000090a07080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000005
160000000000000000000000090a191a17180000000000000000000000000000001718000000001718000000000000000000000000000000000000000000000000000000000000000000080000000000080000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000015
16070800090a0000090a071718191a1718191a090000001718000000000000171818191a09000018191a0900000000000000000000000000000000000000000000000000000000000000000000000000000000000007080708070800000000000000000000000000000000000000000000000000000000000000000000000015
16171800191a0000191718191a191718191a1a0809070818191a09000000001819191a1a080907191a1a0809071718000000000000000000000017180000000000000000000000000000000000000000000008000017181718171800000000000000000000000000000000000000000000000000000000000000000000000015
1618191a191a1a1718171718191a1718191a1a18191718191a1a08090717180000191a1a181917191a1a18191718191a0900001718000017180018191a09000017180000000708070807080708070807080708070807080000070807080708070807080708000000000000000000070807080708070807080000000000000015
16191a001a19171718191a18191718191718191a171819191a1a18191718191a091718191a17181718191a1718191a1a08090718191a0918191a191a1a08090718191a09001718171817181718171817181718171817180000171817181718171817181718000708070807080708171817181718171817180000000000000015
16191a001a191a1718191a1718191a181917181718191a1718191a1718191a1a08191718171819191718171819191a1a181917191a1a08191a1a191a1a181917191a1a080907080018191a090000000018191a090000000017180000000000000000000707080708070807080708070800000800000007080708070807080708
191a001a1a191a1718191a1718191a000017181718191a191718171819191a1a180017181718190017181718191718191a1718191a1a18191a1a1718191a1718191a1a1819171800191a1a0809070800191a1a080907080018191a09000000000000001717181718171817181718171807080708070817181718171817181718
191a00001718191a0000000000000000000000000000000017181718191718191a1718191a1a000000000000001917181718191718191a1718191917181718191718191a1718191a191a1a1819171800191a1a1819171800191a1a08090708171800000000080000000000000000171817181718171817181718171817180015
1a000000000000001718191a1718191a1718191a0000000000000000001917181718191a000000000000000000001718171819191718171917180017181718191917181718191a001718191a1718191a1718191a1718191a191a1a1819171818191a090000000017180000000000000000000000000000000000000000000015
0000000000000000000000001718191a000000000000000000000000000017181718191a000000000000000000000000000000001718170017181718191a00000017181718191a001917181718191a001917181718191a001718191a171819191a1a080907080018191a09000000001718000000000000000000000000000015
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017181718191a000017181718191a001917181718191a191a1a1819171800191a1a080907080018191a0900000000171800000000000015
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017181718191a1718191a1718191a191a1a1819171800191a1a080907080018191a090000000015
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001917181718191a001718191a1718191a191a1a1819171800191a1a080907080715
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017181718191a001917181718191a001718191a1718191a191a1a181917181715
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017181718191a001917181718191a171718191a1718191815
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017181718191a171917181718191a1718
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017181718191a0000
